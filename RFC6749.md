# RFC 6749

[OAuth 2.0 - RFC 6749](https://datatracker.ietf.org/doc/html/rfc6749 'RFC 6749')

授权方式:

- 授权码授权(Authorization Code Grant)
- 隐藏式授权(Implicit Grant)
- 密码式授权(Resource Owner Password Credentials Grant)
- 客户端凭证授权(Client Credentials Grant)
- 扩展式授权(Extension Grants), 略

## 1 授权码授权

### 1.1 流程图

```
 +----------+
 | Resource |
 |   Owner  |
 |          |
 +----------+
      ^
      |
     (B)
 +----|-----+          Client Identifier      +---------------+
 |         -+----(A)-- & Redirection URI ---->|               |
 |  User-   |                                 | Authorization |
 |  Agent  -+----(B)-- User authenticates --->|     Server    |
 |          |                                 |               |
 |         -+----(C)-- Authorization Code ---<|               |
 +-|----|---+                                 +---------------+
   |    |                                         ^      v
  (A)  (C)                                        |      |
   |    |                                         |      |
   ^    v                                         |      |
 +---------+                                      |      |
 |         |>---(D)-- Authorization Code ---------'      |
 |  Client |          & Redirection URI                  |
 |         |                                             |
 |         |<---(E)----- Access Token -------------------'
 +---------+       (w/ Optional Refresh Token)
```

流程说明:

(A) 客户端通过引导资源所有者的用户代理到授权端点。客户包括它的客户端标识符、请求的范围、本地状态和一个授权服务器将向其发送重定向 URI一旦访问被授予（或拒绝），用户代理就会返回。

(B) 授权服务器对资源所有者进行身份验证（通过用户代理）并确定资源所有者是否授予或拒绝客户端的访问请求。

(C) 假设资源所有者授予访问权限，则授权服务器使用以下命令将用户代理重定向回客户端之前提供的重定向 URI（在请求中或在客户注册）。重定向 URI 包括一个客户端提供的授权码和任何本地状态早些时候。

(D) 客户端向授权请求访问令牌服务器的令牌端点，包括授权代码上一步收到。在提出请求时，客户端向授权服务器进行身份验证。客户端包括用于获得授权的重定向 URI验证码。

(E) 授权服务器对客户端进行身份验证，验证授权码，并确保重定向 URI接收到匹配用于重定向客户端的 URI步骤（C）。如果有效，授权服务器响应访问令牌和可选的刷新令牌。

### 1.2 授权请求

|参数|是否必需|说明|
|--|--|--|
|response_type|REQUIRED|Value MUST be set to "code".|
|client_id|REQUIRED|client_id|
|redirect_uri|OPTIONAL|重定向地址|
|scope|OPTIONAL|授权范围|
|state|RECOMMENDED|An opaque value used by the client to maintainstate between the request and callback.  The authorizationserver includes this value when redirecting the user-agent back to the client.|

示例:

```
GET /oauth/authorize?response_type=code&client_id=messaging-client&redirect_uri=http://localhost
```

### 1.3 授权响应

|参数|是否必需|说明|
|--|--|--|
|code|REQUIRED|The authorization code generated by theauthorization server|
|state|REQUIRED|if the "state" parameter was present in the clientauthorization request.|

示例:

```
Location: http://localhost/?code=W636oE&state=xyz
```

### 1.4 访问令牌请求

|参数|是否必需|说明|
|--|--|--|
|grant_type|REQUIRED|Value MUST be set to "authorization_code".|
|code|REQUIRED|The authorization code received from theauthorization server.|
|redirect_uri|REQUIRED|重定向地址|
|client_id|REQUIRED|client_id|

示例:

```
POST /oauth/token?grant_type=authorization_code&code=W636oE&client_id=messaging-client&client_secret=secret&redirect_uri=http://localhost
```

### 1.5 访问令牌响应

示例:

```json
 {
   "access_token":"2YotnFZFEjr1zCsicMWpAA",
   "token_type":"example",
   "expires_in":3600,
   "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA",
   "example_parameter":"example_value"
 }
```

## 2 隐藏式授权

### 2.1 流程图

```
 +----------+
 | Resource |
 |  Owner   |
 |          |
 +----------+
      ^
      |
     (B)
 +----|-----+          Client Identifier     +---------------+
 |         -+----(A)-- & Redirection URI --->|               |
 |  User-   |                                | Authorization |
 |  Agent  -|----(B)-- User authenticates -->|     Server    |
 |          |                                |               |
 |          |<---(C)--- Redirection URI ----<|               |
 |          |          with Access Token     +---------------+
 |          |            in Fragment
 |          |                                +---------------+
 |          |----(D)--- Redirection URI ---->|   Web-Hosted  |
 |          |          without Fragment      |     Client    |
 |          |                                |    Resource   |
 |     (F)  |<---(E)------- Script ---------<|               |
 |          |                                +---------------+
 +-|--------+
   |    |
  (A)  (G) Access Token
   |    |
   ^    v
 +---------+
 |         |
 |  Client |
 |         |
 +---------+
```

流程说明:

(A) 客户端通过引导资源所有者的用户代理到授权端点。客户包括它的客户端标识符、请求的范围、本地状态和一个授权服务器将向其发送重定向 URI一旦访问被授予（或拒绝），用户代理就会返回。

(B) 授权服务器对资源所有者进行身份验证（通过用户代理）并确定资源所有者是否授予或拒绝客户端的访问请求。

(C) 假设资源所有者授予访问权限，则授权服务器使用以下命令将用户代理重定向回客户端之前提供的重定向 URI。重定向 URI 包括URI 片段中的访问令牌。

(D) 用户代理遵循重定向指令请求到 Web 托管的客户端资源（它不包括每个 [ RFC2616 ]的片段）。用户代理保留本地片段信息。

(E) Web 托管的客户端资源返回一个网页（通常是一个带有嵌入脚本的 HTML 文档）能够访问完整的重定向 URI，包括保留的片段用户代理，并提取访问令牌（和其他参数）包含在片段中。

(F) user-agent 执行 web-hosted 提供的脚本本地客户端资源，用于提取访问令牌。

(G) 用户代理将访问令牌传递给客户端。

### 2.2 授权请求

|参数|是否必需|说明|
|--|--|--|
|response_type|REQUIRED|Value MUST be set to "token".|
|client_id|REQUIRED|client_id|
|redirect_uri|OPTIONAL|重定向地址|
|scope|OPTIONAL|授权范围|
|state|RECOMMENDED|An opaque value used by the client to maintainstate between the request and callback.  The authorizationserver includes this value when redirecting the user-agent back to the client.|

示例:

```
GET /oauth/authorize?response_type=token&client_id=messaging-client&state=xyz&redirect_uri=http://localhost
```

### 2.3 访问令牌响应

|参数|是否必需|说明|
|--|--|--|
|access_token|REQUIRED|The access token issued by the authorization server.|
|token_type|REQUIRED|The type of the token.  Value is case insensitive.|
|expires_in|RECOMMENDED|The lifetime in seconds of the access token.|
|scope|OPTIONAL|if identical to the scope requested by the client; otherwise, REQUIRED.|
|state|REQUIRED|if the "state" parameter was present in the clientauthorization request.  The exact value received from the client.|

示例:

```
Location: http://localhost#access_token=2YotnFZFEjr1zCsicMWpAA&state=xyz&token_type=example&expires_in=3600
```

## 3 密码式授权

### 3.1 流程图

```
 +----------+
 | Resource |
 |  Owner   |
 |          |
 +----------+
      v
      |    Resource Owner
     (A) Password Credentials
      |
      v
 +---------+                                  +---------------+
 |         |>--(B)---- Resource Owner ------->|               |
 |         |         Password Credentials     | Authorization |
 | Client  |                                  |     Server    |
 |         |<--(C)---- Access Token ---------<|               |
 |         |    (w/ Optional Refresh Token)   |               |
 +---------+                                  +---------------+
```

流程说明:

(A) 资源所有者向客户端提供其用户名和密码。

(B) 客户端向授权请求访问令牌服务器的令牌端点，包括收到的凭据来自资源所有者。在提出请求时，客户端与授权服务器进行身份验证。

(C) 授权服务器对客户端进行身份验证并验证资源所有者凭据，如果有效，则发出访问权限令牌。

### 3.2 授权请求和响应

客户端获得访问令牌后，必须丢弃凭据。

### 3.3 访问令牌请求

|参数|是否必需|说明|
|--|--|--|
|grant_type|REQUIRED|Value MUST be set to "password".|
|username|REQUIRED|The resource owner username.|
|password|REQUIRED|The resource owner password.|
|scope|OPTIONAL||scope|OPTIONAL|授权范围||

示例:

```
POST /oauth/token?grant_type=password&username=johndoe&password=A3ddj3w
```

### 3.4 访问令牌响应

示例:

```json
 {
   "access_token":"2YotnFZFEjr1zCsicMWpAA",
   "token_type":"example",
   "expires_in":3600,
   "refresh_token":"tGzv3JOkF0XG5Qx2TlKWIA",
   "example_parameter":"example_value"
 }
```

## 4 客户端凭证授权

### 4.1 流程图

```
 +---------+                                  +---------------+
 |         |                                  |               |
 |         |>--(A)- Client Authentication --->| Authorization |
 | Client  |                                  |     Server    |
 |         |<--(B)---- Access Token ---------<|               |
 |         |                                  |               |
 +---------+                                  +---------------+
```

流程说明:

(A) 客户端向授权服务器进行身份验证，并且从令牌端点请求访问令牌。

(B) 授权服务器对客户端进行身份验证，如果有效，发出访问令牌。

### 4.2 授权请求和响应

由于客户端身份验证用作授权授予，不需要额外的授权请求。

### 4.3 访问令牌请求

|参数|是否必需|说明|
|--|--|--|
|grant_type|REQUIRED|Value MUST be set to "client_credentials".|
|scope|OPTIONAL||scope|OPTIONAL|授权范围||

示例:

```
POST /oauth/token?grant_type=client_credentials
```

### 4.4 访问令牌响应

示例:

```json
 {
   "access_token":"2YotnFZFEjr1zCsicMWpAA",
   "token_type":"example",
   "expires_in":3600,
   "example_parameter":"example_value"
 }
```
