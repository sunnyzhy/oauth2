# 表结构说明

## 授权服务相关的表

### oauth_client_details

|字段|描述|
|--|--|
|client_id|主键，必须唯一。在实际应用中也可以称为 clientId， appId， appKey 等。|
|resource_ids|客户端所能访问的资源 id 集合，多个资源时用逗号(，)分隔，如: "user,log"。|
|client_secret|用于指定客户端(client)的访问密匙，必须是加密过的密文。在实际应用中也可以称为 appSecret 等。|
|scope|用于指定客户端的授权范围，可自定义，如: read, write, trust 等，多个授权范围之间用逗号(，)分隔，如: "read,write"。|
|authorized_grant_types|授权类型，取值范围: **authorization_code, password, refresh_token, implicit, client_credentials**; 多个授权类型之间用逗号(,)分隔，如: "authorization_code,refresh_token"。|
|web_server_redirect_uri|重定向URI，当 grant_type 为 authorization_code 或 implicit 时， redirect_uri不能为空，并且 url 里设置的 redirect_uri 必须跟数据库里的 redirect_uri 一致。|
|authorities|授权的角色，多个角色之间用逗号(,)分隔， 如: "ROLE_ADMIN,ROLE_USER"。|
|access_token_validity|access_token 的有效时间(单位:秒)，默认的有效时间 = 60 * 60 * 12 = 12 小时。|
|refresh_token_validity|refresh_token 的有效时间值(单位:秒)，默认的有效时间 = 60 * 60 * 24 * 30 = 30 天。|
|additional_information|预留字段，一般用来存储 JSON 格式的数据。|
|autoapprove|是否自动授权: true, false, read, write; 默认值为 false; 该字段只适用于 grant_type="authorization_code" 的情况。|

### oauth_access_token

|字段|描述|
|--|--|
|token_id|授权服务返回的 access_token 经过 MD5 加密后的字符串。|
|token|二进制字段，存储授权服务返回的 access_token 值。|
|authentication_id|根据当前的 username(如果有), client_id, scope 通过 MD5 加密生成的字符串。|
|user_name|认证的用户名，若客户端没有用户名(如 grant_type="client_credentials" )，则该值等于client_id|
|client_id|oauth_client_details.client_id|
|authentication|二进制字段，存储 OAuth2Authentication 对象。|
|refresh_token|授权服务返回的 refresh_token 经过 MD5 加密后的字符串。|

### oauth_refresh_token

|字段|描述|
|--|--|
|token_id|授权服务返回的 refresh_token 经过 MD5 加密后的字符串。|
|token|二进制字段，存储授权服务返回的 refresh_token 值。|
|authentication|二进制字段，存储 OAuth2Authentication 对象。|

### oauth_approvals

|字段|描述|
|--|--|
|userId|认证的用户名。|
|clientId|oauth_client_details.client_id|
|scope|oauth_client_details.scope，如果是多个 scope，则每个 scope 单独存储为一条记录。 |
|status|ApprovalStatus，取值范围: **APPROVED, DENIED**|
|expiresAt|Approval 的有效期。|
|lastModifiedAt|最后一次修改 Approval 的时间。|

### oauth_code

|字段|描述|
|--|--|
|code|授权服务返回的授权码。|
|authentication|二进制字段，存储 AuthorizationRequestHolder对象。|

### clientdetails

定制版的 oauth_client_details，字段含义基本相同。

|字段|描述|
|--|--|
|app_id|主键，必须唯一。在实际应用中也可以称为 client_id， clientId， appKey 等。|
|resource_ids|客户端所能访问的资源 id 集合，多个资源时用逗号(，)分隔，如: "user-resource，log-resource"。|
|app_secret|用于指定客户端(client)的访问密匙，必须是加密过的密文。在实际应用中也可以称为 client_secret 等。|
|scope|用于指定客户端的授权范围，可自定义 read, write, trust 等，多个授权范围之间用逗号(，)分隔，如: "read,write"。|
|grant_types|授权类型，取值范围: **authorization_code, password, refresh_token, implicit, client_credentials**; 多个授权类型之间用逗号(,)分隔，如: "authorization_code,refresh_token"。|
|redirect_url|重定向URI，当 grant_type 为 authorization_code 或 implicit 时， redirect_uri不能为空，并且 url 里设置的 redirect_uri 必须跟数据库里的 redirect_uri 一致。|
|authorities|授权的角色，多个角色之间用逗号(,)分隔， 如: "ROLE_ADMIN,ROLE_USER"。|
|access_token_validity|access_token 的有效时间(单位:秒)，默认的有效时间 = 60 * 60 * 12 = 12小时。|
|refresh_token_validity|refresh_token 的有效时间值(单位:秒)，默认的有效时间 = 60 * 60 * 24 * 30 = 30天。|
|additional_information|预留字段，一般用来存储 JSON 格式的数据。|
|auto_approve_scopes|是否自动授权: true, false, read, write; 默认值为 false; 该字段只适用于 grant_type="authorization_code" 的情况。|

## 客户端相关的表

### oauth_client_token

|字段|描述|
|--|--|
|token_id|授权服务返回的 token_id。|
|token|二进制字段，存储授权服务返回的 access_token 值。|
|authentication_id|根据当前的 username(如果有), client_id, scope 通过 MD5 加密生成的字符串。|
|user_name|认证的用户名|
|client_id|oauth_client_details.client_id|
